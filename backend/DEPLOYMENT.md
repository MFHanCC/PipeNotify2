# Railway Backend Deployment Guide

## Prerequisites
1. Railway account: https://railway.app
2. GitHub repository connected to Railway
3. Railway CLI installed: `npm install -g @railway/cli`

## Railway Project Setup

### 1. Create Railway Project
```bash
railway login
railway new
# Select "Deploy from GitHub repo"
# Choose your repository
# Select "backend" folder as deployment path
```

### 2. Add Services
In Railway dashboard:
1. **PostgreSQL**: Add PostgreSQL service (auto-generates DATABASE_URL)
2. **Redis**: Add Redis service (auto-generates REDIS_URL)

### 3. Environment Variables
Set in Railway Dashboard → Environment Variables:

**Auto-generated by Railway:**
- `DATABASE_URL` (PostgreSQL service)
- `REDIS_URL` (Redis service)

**Required manual setup:**
- `PIPEDRIVE_API_TOKEN` - Get from Pipedrive App settings
- `SENTRY_DSN` - Get from Sentry.io project settings
- `NODE_ENV=production`
- `FRONTEND_URL` - Set after Vercel deployment (e.g., https://your-app.vercel.app)
- `JWT_SECRET` - Generate secure random string
- `WEBHOOK_SECRET` - Generate secure random string for webhook validation

**Optional performance tuning:**
- `RATE_LIMIT_WINDOW_MS=900000` (15 minutes)
- `RATE_LIMIT_MAX_REQUESTS=100`

### 4. Database Migration
After deployment, run migration in Railway console:
```bash
railway shell
psql $DATABASE_URL < db/schema.sql
```

### 5. Custom Domain (Optional)
Configure custom domain in Railway Dashboard → Settings → Domains

## Deployment Commands

### Manual Deployment
```bash
cd backend
railway login
railway link [your-project-id]
railway up
```

### Environment Check
```bash
railway variables
railway logs
```

### Database Access
```bash
railway connect postgres
```

## Health Check
After deployment, verify:
- `GET https://your-backend.railway.app/health` returns 200
- `GET https://your-backend.railway.app/status` shows environment info
- Logs show successful database and Redis connections

## Troubleshooting
- Check Railway logs: `railway logs --tail`
- Verify environment variables: `railway variables`
- Test database connection: `railway connect postgres`
- Check service status in Railway dashboard